{"code":"#include <iostream>\r\n#include <algorithm>\r\n#include <vector>\r\n\r\nusing namespace std;\r\n#define ff first\r\n#define ss second\r\n\r\ntypedef long long ll;\r\n\r\nint const N = 1e5+9;\r\nll a[N];\r\nll sum[N],sum1[N];\r\nll t[N<<2];\r\nll lazy[N<<2];\r\n\r\nvoid build(int v,int l,int r){\r\n  if(l==r){\r\n    t[v]=a[l];\r\n    return;\r\n  }\r\n  int m=(l+r)>>1;\r\n  build(v<<1,l,m);\r\n  build(v<<1|1,m+1,r);\r\n}\r\nvoid push(int v,int l,int r){\r\n  if(l!=r&&lazy[v])\r\n    lazy[v<<1]=lazy[v<<1|1]=lazy[v];\r\n  if(lazy[v])\r\n    t[v]=lazy[v];\r\n  \r\n  lazy[v]=0;\r\n  \r\n}\r\nvoid rebuild(int v, int l,int r){\r\n  push(v,l,r);\r\n  if(l==r){a[l]=t[v];\r\n    return;\r\n  }\r\n  int m=(l+r)>>1;\r\n  rebuild(v<<1,l,m);\r\n  rebuild(v<<1|1,m+1,r);\r\n}\r\nvoid upd(int v,int tl,int tr,int l,int r,int x){\r\n  if(tl>r||tr<l)\r\n    return;\r\n  push(v,tl,tr);\r\n  if(l<=tl&&tr<=r){\r\n    lazy[v]=x;\r\n    return;\r\n  }\r\n  int tm=(tl+tr)>>1;\r\n  upd(v<<1,tl,tm,l,r,x);\r\n  upd(v<<1|1,tm+1,tr,l,r,x);\r\n}\r\nint main() {ios_base::sync_with_stdio(false);cin.tie(0);cout.tie(0);\r\n    int n, q;\r\n    cin >> n >> q;\r\n    for(int i = 1; i <= n; i ++)\r\n        cin >> a[i];\r\n    vector < pair<pair<int, int>, pair<int, int> > > v(q);\r\n    for(int i = 0; i < q; i ++) {\r\n        int t, l, r, x;\r\n        cin >> t >> l >> r >> x;\r\n        if(t == 1) {\r\n            if(x < 0)\r\n                t = 1;\r\n            else\r\n                t = 4;\r\n        } else {\r\n            if(x < 0) \r\n                t = 2;\r\n            else\r\n                t = 3;\r\n        }\r\n        v[i] = make_pair(make_pair(t, x), make_pair(l, r));\r\n    }\r\n    \r\n    sort(v.begin(), v.end());\r\n    int i=0;\r\n    for(;i < q;){\r\n      if(v[i].ff.ff>1)\r\n      break;\r\n      else {\r\n        sum[v[i].ss.ff]+=v[i].ff.ss;\r\n        sum[v[i].ss.ss+1]-=v[i].ff.ss;\r\n    }\r\n    i++;\r\n  }\r\n  \r\n  for(int i=1;i<=n;i++){\r\n    sum[i]+=sum[i-1];\r\n    a[i]+=sum[i];\r\n  }\r\n  \r\n  build(1,1,n);\r\n  for(;i < q;){\r\n      if(v[i].ff.ff>3)\r\n      break;\r\n      else \r\n        upd(1,1,n,v[i].ss.ff,v[i].ss.ss,v[i].ff.ss);\r\n    i++;\r\n  }\r\n  rebuild(1,1,n);\r\n  for(;i < q; i ++){\r\n      sum1[v[i].ss.ff]+=v[i].ff.ss;\r\n      sum1[v[i].ss.ss+1]-=v[i].ff.ss;\r\n  }for(int i=1;i<=n;i++){\r\n    sum1[i]+=sum1[i-1];\r\n    a[i]+=sum1[i];\r\n  }\r\n    for(int i = 1; i <= n; i ++)\r\n        cout << a[i] << ' ';\r\n}","lang":4}