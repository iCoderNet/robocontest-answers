{"code":"\/*\r\n\u2588\u2588    \u2588\u2588  \u2588\u2588\u2588\u2588\u2588\u2588  \u2588\u2588\u2588\u2588\u2588\u2588  \u2588\u2588   \u2588\u2588\r\n\u2588\u2588\u2588  \u2588\u2588\u2588  \u2588\u2588        \u2588\u2588     \u2588\u2588 \u2588\u2588\r\n\u2588\u2588 \u2588\u2588 \u2588\u2588  \u2588\u2588        \u2588\u2588      \u2588\u2588\r\n\u2588\u2588    \u2588\u2588  \u2588\u2588        \u2588\u2588      \u2588\u2588\r\n\r\n  \u2588\u2588\u2588\u2588  \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588     \u2588\u2588      \u2588\u2588   \u2588\u2588  \u2588\u2588  \u2588\u2588  \u2588\u2588\u2588\u2588\u2588\u2588  \u2588\u2588   \u2588\u2588\r\n \u2588\u2588        \u2588\u2588       \u2588\u2588\u2588\u2588     \u2588\u2588   \u2588\u2588  \u2588\u2588 \u2588\u2588   \u2588\u2588      \u2588\u2588   \u2588\u2588\r\n \u2588\u2588        \u2588\u2588      \u2588\u2588  \u2588\u2588    \u2588\u2588\u2588\u2588\u2588\u2588\u2588  \u2588\u2588\u2588\u2588    \u2588\u2588\u2588\u2588    \u2588\u2588\u2588\u2588\u2588\u2588\u2588\r\n \u2588\u2588        \u2588\u2588     \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588   \u2588\u2588   \u2588\u2588  \u2588\u2588 \u2588\u2588   \u2588\u2588      \u2588\u2588   \u2588\u2588\r\n  \u2588\u2588\u2588\u2588     \u2588\u2588    \u2588\u2588\u2588    \u2588\u2588\u2588  \u2588\u2588   \u2588\u2588  \u2588\u2588  \u2588\u2588  \u2588\u2588\u2588\u2588\u2588\u2588  \u2588\u2588   \u2588\u2588\r\n*\/\r\n#include<bits\/stdc++.h>\r\nusing namespace std;\r\n\r\ntemplate<typename... T>\r\n#define error(args...) { string _s = #args; replace(_s.begin(), _s.end(), ',', ' '); stringstream _ss(_s); istream_iterator<string> _it(_ss); err(_it, args); }\r\nvoid err(istream_iterator<string> it) {}\r\ntemplate<typename T, typename... Args>\r\nvoid err(istream_iterator<string> it, T a, Args... args) {cerr << *it << \"=\" << a << \", \"; err(++it, args...);}\r\n\r\n#define int long long\r\n#define pb push_back\r\n#define F first\r\n#define S second\r\n\r\nconst int inf = 1LL<<62;\r\nconst int md = 1000000007;\r\n\r\npair<int,int> seg[1000005];\r\nint mark[1000005];\r\n\r\nvoid push(int k) {\r\n    if (mark[k]) {\r\n        mark[k] = 0;\r\n        seg[2*k].F = seg[2*k + 1].F = seg[k].F\/2;\r\n        seg[2*k].S = seg[2*k + 1].S = 0;\r\n        mark[2*k] = mark[2*k + 1] = 1;\r\n    }   \r\n}\r\n\r\nvoid update(int v, int a, int b, int k, int x, int y) {\r\n    if (b < x || a > y) return;\r\n    if (a<=x && b>=y) {\r\n        seg[k].S += v;\r\n        return;\r\n    }\r\n    int h = min(b,y) - max(a,x) + 1;\r\n    push(k); \r\n    seg[k].F += h*v;\r\n    int d = (x+y)\/2;\r\n    update(v, a, b, 2*k, x, d);\r\n    update(v, a, b, 2*k + 1, d + 1, y);\r\n}\r\nint assign(int v, int a, int b, int k, int x, int y) {\r\n    if (b < x || a > y) return seg[k].F + (y - x + 1)*seg[k].S;\r\n    if (a <= x && b >= y) {\r\n        seg[k].F = (y-x+1)*v;\r\n        seg[k].S = 0;\r\n        mark[k] = 1; \r\n        return seg[k].F;\r\n    }\r\n    push(k); \r\n    int d = (x+y)\/2;\r\n    seg[2*k].S += seg[k].S,  seg[2*k + 1].S += seg[k].S;\r\n    seg[k].S = 0;\r\n    seg[k].F = assign(v, a, b, 2*k, x, d) + assign(v, a, b, 2*k + 1, d + 1, y);\r\n    return seg[k].F;\r\n\r\n}\r\nint sum(int a, int b, int k, int x, int y) {\r\n    if (b < x || a > y) return 0;\r\n    if (a <= x && b >= y) {\r\n        return seg[k].F + (y-x+1)*seg[k].S;\r\n    }\r\n    push(k); \r\n    seg[k].F += (y-x+1)*seg[k].S;\r\n    seg[2*k].S += seg[k].S, seg[2*k + 1].S += seg[k].S;\r\n    seg[k].S = 0;\r\n    int d = (x+y)\/2;\r\n    return sum(a, b, 2*k, x, d) + sum(a, b, 2*k + 1, d + 1, y);\r\n}\r\nvoid solve(){\r\n    int n,q; cin>>n>>q;\r\n    int nn =n;\r\n    n = 1<<(int)ceil(log2(n));\r\n    for (int i = 0; i< nn; i++) {\r\n        int x; cin>>x;\r\n        update(x,i,i,1,0,n-1);\r\n    }\r\n    while (q--) {\r\n        int z;\r\n        cin>>z;\r\n        if (z == 1) {\r\n            int a,b,x;\r\n            cin>>a>>b>>x;\r\n            a--,b--;\r\n            update(x,a,b,1,0,n-1);\r\n        }\r\n        else if (z == 2) {\r\n            int a,b,x;\r\n            cin>>a>>b>>x;\r\n            a--,b--;\r\n            assign(x,a,b,1,0,n-1);\r\n        }\r\n        else {\r\n            int a,b;\r\n            cin>>a>>b; a--, b--;\r\n            cout<<sum(a,b,1,0,n-1)<<'\\n';\r\n        }\r\n    }\r\n}    \r\nsigned main(){\r\n    ios_base::sync_with_stdio(false);cin.tie(0);cout.tie(0);\r\n    #ifdef LOCAL\r\n    #endif\r\n    int t=1;\r\n    \/\/ cin>>t;\r\n    for (int i = 1; i <= t; i++) {\r\n        solve();\r\n        cout<<'\\n';\r\n    }\r\n}","lang":4}