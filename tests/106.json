{"code":"#include<bits\/stdc++.h>\r\n#define rep(i,j,k) for(register int i = j; i <= k; ++i)\r\n#define dow(i,j,k) for(register int i = j; i >= k; --i)\r\nusing namespace std;\r\n \r\ninline int read() { \r\n    int s = 0, t = 1; char c = getchar();\r\n    while( !isdigit(c) ) { if( c == '-' ) t = -1; c = getchar(); }\r\n    while( isdigit(c) ) s = s * 10 + c - 48, c = getchar();\r\n    return s * t;\r\n}\r\nconst int N = 4e6+5, inf = 1e9+7;\r\nint n, m, maxl, now, pre, f[2][N], v[N], g[N], h[N], sum[N]; \r\n\r\nint main() {\r\n  n = read(), m = read(), now = 0, pre = 1;\r\n  rep(i,1,n) { \r\n    swap(now,pre); \r\n    rep(j,1,m) v[j] = read();\r\n    rep(j,1,m) sum[j] = sum[j-1] + v[j];\r\n    rep(j,1,m) g[j] = max(g[j-1]+v[j],0);\r\n    dow(j,m,1) h[j] = max(h[j+1]+v[j],0);\r\n    maxl = -inf;\r\n    rep(j,1,m) { \r\n      maxl = max(maxl,f[pre][j]-sum[j-1]+g[j-1]);\r\n      f[now][j] = maxl+sum[j]+h[j+1];\r\n    } \r\n    maxl = -inf;\r\n    dow(j,m,1) { \r\n      maxl = max(maxl,f[pre][j]+sum[j]+h[j+1]);\r\n      f[now][j] = max(f[now][j],maxl-sum[j-1]+g[j-1]);\r\n    }\r\n  }\r\n  int ans = 0;\r\n  rep(i,1,m) ans = max(ans,f[now][i]);\r\n  cout<<ans;\r\n  return 0;\r\n}","lang":4}